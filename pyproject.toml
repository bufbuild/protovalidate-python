[build-system]
requires = ["hatchling", "hatch-vcs"]
build-backend = "hatchling.build"

[project]
name = "protovalidate"
description = "Protocol Buffer Validation for Python"
readme = "README.md"
license = "Apache-2.0"
license-files = ["LICENSE"]
keywords = ["validate", "protobuf", "protocol buffer"]
# Keep our minimum version synced with ./.python-version.
requires-python = ">=3.9"
classifiers = [
  "Programming Language :: Python :: 3.9",
  "Programming Language :: Python :: 3.10",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
  "Programming Language :: Python :: 3.13",
  "Operating System :: OS Independent",
  "Typing :: Typed",
]
dynamic = ["version"]
dependencies = [
    "protobuf>=5",
    "cel-python==0.2.*",
    # We need at least this version, which started publishing wheels for Python 3.13.
    # Ref: https://github.com/google/re2/issues/516
    "google-re2>=1.1.20250722; python_version == '3.13'",
    # 1.1 started supporting 3.12.
    "google-re2>=1.1; python_version == '3.12'",
    "google-re2>=1",
]

[project.urls]
Homepage = "https://github.com/bufbuild/protovalidate-python"
Source = "https://github.com/bufbuild/protovalidate-python"
Issues = "https://github.com/bufbuild/protovalidate-python/issues"

[dependency-groups]
dev = [
	"google-re2-stubs>=0.1.1",
	"mypy>=1.17.1",
	"pytest>=8.4.1",
	"ruff>=0.12.0",
	"types-protobuf>=5.29.1.20250315",
]

[tool.uv]
resolution = "lowest-direct"

[tool.hatch.version]
source = "vcs"
raw-options = { fallback_version = "0.0.0" }

[tool.ruff]
line-length = 120
lint.select = [
	"A",
	"ARG",
	"B",
	"C",
	"DTZ",
	"E",
	"EM",
	"F",
	"FBT",
	"I",
	"ICN",
	"N",
	"PLC",
	"PLE",
	"PLR",
	"PLW",
	"Q",
	"RUF",
	"S",
	"T",
	"TID",
	"UP",
	"W",
	"YTT",
]
lint.ignore = [
	# Ignore complexity
	"C901",
	"PLR0911",
	"PLR0912",
	"PLR0913",
	"PLR0915",
	# Ignore magic values - in this library, most are obvious in context.
	"PLR2004",
]

[tool.ruff.lint.isort]
known-first-party = ["protovalidate", "buf"]

[tool.ruff.lint.flake8-tidy-imports]
ban-relative-imports = "all"

[tool.ruff.lint.per-file-ignores]
# Tests can use assertions.
"test/**/*" = ["S101"]

[tool.pytest.ini_options]
# restrict testpaths to speed up test discovery
testpaths = ["test"]

[tool.mypy]
mypy_path = "gen"

[tool.ty.environment]
extra-paths = ["gen"]
